<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/22b1cec598.js" crossorigin="anonymous"></script>   
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/problem7.css">
    <title>Problema 7</title>
</head>
<body>
    <%- include('./partials/header') %>
    <div class='container'>
        <h2>Problema 7</h2>
            <div class="container__form">
                <form action="" id ="form__tasks" class="form__inputs">
                    <label for="name_task">Nombre de la tarea</label>
                    <input type="text" name="name_task" id="name_task" class="form_inputs-task">
                    
                    <label for="date">Fecha</label>
                    <input type="date" name="date" id="date" class="form_inputs-date">
                    
                    <label for="priority">Prioridad</label>
                    <input type="text" name="priority" id="priority" class="form_inputs-priority">
                    
                    <label for="description">Descripción</label>
                    <input type="text" name="description" id="description" class="form_inputs-description">
                    <button type="reset" class="btnClear">Limpiar</button>
                    <button type="submit" id="btnAdd" class="btnAdd">Agregar</button>
                </form>              
            </div>

            <div class="container__table">
                <table class="table__tasks">
                    <thead class="table__tasks-head">
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">NOMBRE DE LA TAREA</th>
                            <th scope="col">FECHA</th>
                            <th scope="col">PRIORIDAD</th>
                            <th scope="col">DESCRIPCIÓN</th>
                            <th scope="col">ACCIONES</th>
                        </tr>
                    </thead>
                    <tbody id="items"></tbody>
                </table>
            </div>

            <template id="template__tasks">
                <tr>
                    <th scope="row">id</th>
                    <td>NOMBRE DE LA TAREA</td>
                    <td>FECHA</td>
                    <td>PRIORIDAD</td>
                    <td>DESCRIPCIÓN</td>
                    <td>
                        <button class="btnEdit">Editar</button>
                        <button class="btnDelete">Borrar</button>
                    </td>
                </tr>
            </template>
        </div>
        <script>

        const items = document.getElementById('items')
        const tasks = document.getElementById('form__tasks')
        const templateTask = document.getElementById('template__tasks').content
        const taskInput = document.querySelector('#name_task');
        const dateInput = document.querySelector('#date');
        const priorityInput = document.querySelector('#priority');
        const descriptionInput = document.querySelector('#description');
        const btnAdd = document.querySelector('#btnAdd');
        const fragment = document.createDocumentFragment()
        let listTask = {};
        let editing = 0;
        
        tasks.addEventListener('submit', (e) => { 
            e.preventDefault()           
            if(taskInput.value === '' || dateInput === '' || priorityInput === '' || descriptionInput === ''){
            alert('Todos los campos son obligatorios');
            return;
            }

            if(editing){
                editTask()
                editing = false;                
            } else {
                addTask(e)
            }
        });

        items.addEventListener('click', (e) => {
            loadTask(e)
        })        
        
        const addTask = e => {

            
            if (e.target.classList.contains('form__inputs')) {
                // console.log(e.target.dataset.id)
                // console.log(e.target.parentElement)
                setTask(e.target.parentElement)
            }
            e.stopPropagation();
        }

        const setTask = item => {
            const element = {
                name: item.querySelector('#name_task').value,
                date: item.querySelector('#date').value,
                priority: item.querySelector('#priority').value,
                description: item.querySelector('#description').value,
                id: Date.now()
            }

            listTask[element.id] = { ...element }

            displayTask();
        }

        const displayTask = () => {
            
            items.innerHTML = ''
            console.log(listTask)
            Object.values(listTask).forEach(element => {
                templateTask.querySelector('th').textContent = element.id
                templateTask.querySelectorAll('td')[0].textContent = element.name
                templateTask.querySelectorAll('td')[1].textContent = element.date
                templateTask.querySelectorAll('td')[2].textContent = element.priority
                templateTask.querySelectorAll('td')[3].textContent = element.description
                
                //botones
                templateTask.querySelector('.btnEdit').dataset.id = element.id
                templateTask.querySelector('.btnDelete').dataset.id = element.id

                const clone = templateTask.cloneNode(true)
                fragment.appendChild(clone)
            })
            items.appendChild(fragment)
        }

        const loadTask = e => {

            const taskAdd = listTask[e.target.dataset.id]
            taskInput.value = taskAdd.name
            dateInput.value = taskAdd.date
            priorityInput.value = taskAdd.priority
            descriptionInput.value = taskAdd.description

            listTask.id = taskAdd.id

            tasks.querySelector('button[type="submit"]').textContent = "Actualizar"

            editing = true
        }

        const  editTask = () => {

            listTask.name = taskInput.value
            listTask.date = dateInput.value
            listTask.priority = priorityInput.value
            listTask.description = descriptionInput.value

            const element = {
                name: listTask.name,
                date: listTask.date,
                priority: listTask.priority,
                description: listTask.description,
                id: listTask.id
            }            
                    listTask[element.id] = {...element}               
            

            displayTask()

            tasks.querySelector('button[type="submit"]').textContent = "Agregar"

            editing = false

        }

    </script>
</body>
</html>